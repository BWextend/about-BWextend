# 草稿——并发编程

- 并发编程领域可以抽象成三个核心问题：分工、同步和互斥。

- 在Java中，解决线程协作问题的核心技术是管程。

- 导致可见行问题的原因是CPU缓存。

- 导致有序性问题的原因是编译优化。

- happens-before规则：前一个操作的结果对后面操作是可见的。
    - 程序的顺序性
    - volatile 变量规则
    - 传递性
    - 管程中锁的规则
    - 线程start()的规则
    - 线程join()的规则

- 原子性：原子性的外在表现是不可分割，本质是中间态不可见。

- 不可用可变对象作为锁对象。

- 死锁：一组相互竞争资源而互相等待导致一直阻塞的场景。
    - 互斥，共享资源 X 和 Y 只能被一个线程占用；
    - 占有且等待，线程 T1 已经取得共享资源 X，在等待共享资源 Y 的时候，不释放共享资源 X；
    - 不可抢占，其他线程不能强行抢占线程 T1 占有的资源；
    - 循环等待，线程 T1 等待线程 T2 占有的资源，线程 T2 等待线程 T1 占有的资源，就是循环等待。

- Java 语言内置的管程synchronized里只有一个条件变量，而 Lock&Condition 实现的管程是支持多个条件变量的。

- Semaphore 可以允许多个线程访问一个临界区。